<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS Finance OS - ×‘×•×¢×– ×¡×¢×“×” ×¤×ª×¨×•× ×•×ª ×™×¦×™×¨×ª×™×™×</title>
    <style>
        :root {
            --primary: #10b981; --danger: #ef4444; --accent: #6366f1;
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-dim: #94a3b8;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
        
        /* Layout */
        .app { max-width: 1200px; margin: auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid #334155; margin-bottom: 30px; }
        .logo-box { display: flex; align-items: center; gap: 15px; }
        .bs-icon { background: var(--primary); color: #000; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-weight: 900; font-size: 1.2rem; }

        /* Dashboard */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); text-align: center; }
        .stat-card h4 { margin: 0; color: var(--text-dim); font-size: 0.8rem; text-transform: uppercase; }
        .stat-card .val { font-size: 1.5rem; font-weight: bold; margin-top: 10px; display: block; }

        /* Forecast Bar */
        .forecast-section { background: rgba(99, 102, 241, 0.1); padding: 20px; border-radius: 20px; border: 1px solid var(--accent); margin-bottom: 30px; }
        .forecast-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .f-item { background: var(--bg); padding: 15px; border-radius: 12px; text-align: center; }

        /* Main Table */
        .table-container { background: var(--card); border-radius: 20px; padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: right; }
        th { color: var(--text-dim); padding: 15px; border-bottom: 1px solid #334155; font-size: 0.85rem; }
        td { padding: 15px; border-bottom: 1px solid #334155; font-size: 0.9rem; }
        .type-tag { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; }

        /* Float Button & Modal */
        .fab { position: fixed; bottom: 30px; left: 30px; width: 60px; height: 60px; background: var(--primary); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4); border: none; transition: 0.3s; z-index: 100; }
        .fab:hover { transform: scale(1.1) rotate(90deg); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); width: 90%; max-width: 500px; padding: 30px; border-radius: 25px; border: 1px solid var(--primary); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { display: block; margin-top: 10px; font-size: 0.8rem; color: var(--text-dim); }
        input, select { width: 100%; padding: 12px; margin-top: 5px; background: var(--bg); border: 1px solid #334155; color: #fff; border-radius: 10px; box-sizing: border-box; }
        .btn-submit { background: var(--primary); color: #000; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; margin-top: 20px; cursor: pointer; }

        .btn-del { color: var(--danger); cursor: pointer; background: none; border: none; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="app">
    <header>
        <div class="logo-box">
            <div class="bs-icon">BS</div>
            <div>
                <h2 style="margin:0;">××¢×¨×›×ª ×¤×™× × ×¡×™×ª ×—×›××”</h2>
                <small style="color:var(--text-dim)">×‘×•×¢×– ×¡×¢×“×” ×¤×ª×¨×•× ×•×ª ×™×¦×™×¨×ª×™×™×</small>
            </div>
        </div>
        <button onclick="localStorage.clear(); location.reload();" style="background:none; border:none; color:var(--text-dim); cursor:pointer;">××™×¤×•×¡ ×”×›×œ</button>
    </header>

    <div class="dashboard">
        <div class="stat-card"><h4>×”×›× ×¡×” ×—×•×“×©×™×ª</h4><span class="val" id="totalInc" style="color:var(--primary)">â‚ª0</span></div>
        <div class="stat-card"><h4>×”×•×¦××•×ª ×•×”×—×–×¨×™×</h4><span class="val" id="totalExp" style="color:var(--danger)">â‚ª0</span></div>
        <div class="stat-card"><h4>×™×ª×¨×” × ×•×›×—×™×ª</h4><span class="val" id="currentBal">â‚ª0</span></div>
    </div>

    <div class="forecast-section">
        <h3 style="margin:0;">ğŸ”® ××‘×˜ ×œ×¢×ª×™×“ (×ª×—×–×™×ª ×ª×–×¨×™× 3 ×—×•×“×©×™×)</h3>
        <div class="forecast-grid" id="forecastGrid"></div>
    </div>

    <div class="table-container">
        <h3>ğŸ“œ ×™×•××Ÿ ×ª× ×•×¢×•×ª ×•×¢×¨×™×›×”</h3>
        <table>
            <thead>
                <tr>
                    <th>×ª××¨×™×š</th>
                    <th>×ª×™××•×¨</th>
                    <th>×§×˜×’×•×¨×™×”</th>
                    <th>×××¦×¢×™ ×ª×©×œ×•×</th>
                    <th>×¡×›×•×</th>
                    <th>×¤×¢×•×œ×•×ª</th>
                </tr>
            </thead>
            <tbody id="txBody"></tbody>
        </table>
    </div>
</div>

<button class="fab" onclick="toggleModal(true)">+</button>

<div class="modal" id="txModal">
    <div class="modal-content">
        <h2 style="margin-top:0; color:var(--primary);">×”×•×¡×¤×ª ×ª× ×•×¢×” ×—×“×©×”</h2>
        <div class="form-grid">
            <div style="grid-column: span 2;">
                <label>×ª×™××•×¨ ×”×¤×¢×•×œ×”:</label>
                <input type="text" id="txDesc" placeholder="×œ××©×œ: ××©×›×•×¨×ª, ×¡×•×¤×¨, ×”×œ×•×•××ª ×¨×›×‘">
            </div>
            <div>
                <label>×¡×›×•× (â‚ª):</label>
                <input type="number" id="txAmount" placeholder="0.00">
            </div>
            <div>
                <label>×¡×•×’:</label>
                <select id="txType" onchange="updateSubOptions()">
                    <option value="income">×”×›× ×¡×” â•</option>
                    <option value="expense">×”×•×¦××” ğŸ”»</option>
                </select>
            </div>
            <div>
                <label>×§×˜×’×•×¨×™×”:</label>
                <select id="txCat"></select>
            </div>
            <div>
                <label>×××¦×¢×™ ×ª×©×œ×•×:</label>
                <select id="txMethod">
                    <option value="×¢×•×´×©">×—×©×‘×•×Ÿ ×¢×•×´×©</option>
                    <option value="××©×¨××™ 1">××©×¨××™ (×¨××©×™)</option>
                    <option value="××©×¨××™ 2">××©×¨××™ (× ×•×¡×£)</option>
                    <option value="××–×•××Ÿ">××–×•××Ÿ</option>
                </select>
            </div>
            <div>
                <label>×ª×“×™×¨×•×ª:</label>
                <select id="txFreq">
                    <option value="once">×—×“-×¤×¢××™</option>
                    <option value="monthly">×§×‘×•×¢ (×›×œ ×—×•×“×©)</option>
                </select>
            </div>
            <div>
                <label>×ª××¨×™×š:</label>
                <input type="date" id="txDate">
            </div>
        </div>
        <button class="btn-submit" onclick="saveTransaction()">×©××•×¨ × ×ª×•× ×™× ×œ××¢×¨×›×ª âœ¨</button>
        <button onclick="toggleModal(false)" style="background:none; border:none; color:var(--text-dim); width:100%; margin-top:10px; cursor:pointer;">×‘×™×˜×•×œ</button>
    </div>
</div>

<script>
    const subCats = {
        income: ["××©×›×•×¨×ª", "×”×›× ×¡×” ×¢×¡×§×™×ª", "×”×—×–×¨ ××¡", "×”×©×§×¢×•×ª"],
        expense: ["××©×›× ×ª×", "××¨× ×•× ×”", "×—×©××œ/××™×", "×¨×›×‘ ×•×“×œ×§", "×¡×•×¤×¨ ×•×§× ×™×•×ª", "×ª×§×©×•×¨×ª", "×”×œ×•×•××•×ª", "×‘×™×œ×•×™×™×", "×©×™×¤×•×¥/×‘×œ×˜×´×"]
    };

    let transactions = JSON.parse(localStorage.getItem('bs_finance_v7') || '[]');

    function toggleModal(show) {
        document.getElementById('txModal').style.display = show ? 'flex' : 'none';
        if(show) {
            document.getElementById('txDate').valueAsDate = new Date();
            updateSubOptions();
        }
    }

    function updateSubOptions() {
        const type = document.getElementById('txType').value;
        const catSelect = document.getElementById('txCat');
        catSelect.innerHTML = subCats[type].map(c => `<option value="${c}">${c}</option>`).join('');
    }

    function saveTransaction() {
        const data = {
            id: Date.now(),
            desc: document.getElementById('txDesc').value,
            amount: parseFloat(document.getElementById('txAmount').value),
            type: document.getElementById('txType').value,
            cat: document.getElementById('txCat').value,
            method: document.getElementById('txMethod').value,
            freq: document.getElementById('txFreq').value,
            date: document.getElementById('txDate').value
        };

        if(!data.desc || !data.amount) return alert("××œ× ×ª×™××•×¨ ×•×¡×›×•×!");

        transactions.unshift(data);
        localStorage.setItem('bs_finance_v7', JSON.stringify(transactions));
        toggleModal(false);
        render();
    }

    function deleteTx(id) {
        if(!confirm("×œ××—×•×§ ××ª ×”×ª× ×•×¢×”?")) return;
        transactions = transactions.filter(t => t.id !== id);
        localStorage.setItem('bs_finance_v7', JSON.stringify(transactions));
        render();
    }

    function render() {
        const body = document.getElementById('txBody');
        let incTotal = 0, expTotal = 0, fixedInc = 0, fixedExp = 0;
        
        body.innerHTML = '';
        transactions.forEach(t => {
            const isInc = t.type === 'income';
            if(isInc) { 
                incTotal += t.amount; 
                if(t.freq === 'monthly') fixedInc += t.amount;
            } else { 
                expTotal += t.amount; 
                if(t.freq === 'monthly') fixedExp += t.amount;
            }

            body.innerHTML += `
                <tr>
                    <td>${t.date}</td>
                    <td><strong>${t.desc}</strong></td>
                    <td><span class="type-tag" style="background:rgba(255,255,255,0.1)">${t.cat}</span></td>
                    <td>${t.method}</td>
                    <td style="color:${isInc ? 'var(--primary)' : 'var(--danger)'}; font-weight:bold;">
                        ${isInc ? '+' : '-'}${t.amount.toLocaleString()} â‚ª
                    </td>
                    <td><button class="btn-del" onclick="deleteTx(${t.id})">ğŸ—‘ï¸</button></td>
                </tr>
            `;
        });

        document.getElementById('totalInc').innerText = `â‚ª${incTotal.toLocaleString()}`;
        document.getElementById('totalExp').innerText = `â‚ª${expTotal.toLocaleString()}`;
        document.getElementById('currentBal').innerText = `â‚ª${(incTotal - expTotal).toLocaleString()}`;

        // Forecast Logic
        const grid = document.getElementById('forecastGrid');
        grid.innerHTML = '';
        let balance = incTotal - expTotal;
        const months = ["×”×—×•×“×©", "×—×•×“×© ×”×‘×", "×‘×¢×•×“ ×—×•×“×©×™×™×"];
        
        for(let i=0; i<3; i++) {
            if(i > 0) balance += (fixedInc - fixedExp);
            const isNeg = balance < 0;
            grid.innerHTML += `
                <div class="f-item">
                    <div style="font-size:0.7rem; color:var(--text-dim)">${months[i]}</div>
                    <div style="font-weight:bold; color:${isNeg ? 'var(--danger)' : 'var(--primary)'}">
                        ${balance.toLocaleString()} â‚ª
                    </div>
                </div>
            `;
        }
    }

    render();
</script>

</body>
</html>
