<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS - Financial Control Center</title>
    <style>
        :root { --primary: #10b981; --danger: #f43f5e; --warning: #f59e0b; --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        
        /* Dashboard Stats */
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #334155; }
        .stat-card h4 { margin: 0; font-size: 0.8rem; color: #94a3b8; }
        .stat-card div { font-size: 1.6rem; font-weight: bold; margin-top: 5px; }

        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        @media (max-width: 850px) { .main-grid { grid-template-columns: 1fr; } }

        .card { background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.4); margin-bottom: 20px; }
        h3 { color: var(--primary); margin-top: 0; border-bottom: 1px solid #334155; padding-bottom: 10px; }

        label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.85rem; color: #94a3b8; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 10px; box-sizing: border-box; }
        
        .btn { background: var(--primary); color: #0f172a; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 15px; font-size: 1rem; }
        .btn-import { background: var(--warning); margin-top: 10px; color: #000; }

        .forecast-container { display: flex; gap: 10px; margin-top: 15px; }
        .f-box { flex: 1; background: #0f172a; padding: 10px; border-radius: 10px; text-align: center; font-size: 0.9rem; border: 1px solid #334155; }

        .log-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #334155; font-size: 0.9rem; }
        .footer { text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #334155; opacity: 0.6; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
        <div style="background: var(--primary); color: #000; width: 50px; height: 50px; line-height: 50px; border-radius: 12px; font-weight: 900; margin: auto; font-size: 1.5rem;">BS</div>
        <h1 style="margin: 10px 0 5px;">×”××¦×¤×Ÿ ×”×¤×™× × ×¡×™ ×©×œ ×‘×•×¢×–</h1>
        <p>× ×™×”×•×œ ×ª×–×¨×™× ××–×•×× ×™× ×•×× ×™×¢×ª ×§×¨×™×¡×”</p>
    </div>

    <div class="stats">
        <div class="stat-card"><h4>×”×›× ×¡×•×ª × ×˜×•</h4><div id="topInc" style="color: var(--primary);">â‚ª0</div></div>
        <div class="stat-card"><h4>×”×•×¦××•×ª ×•×”×—×–×¨×™×</h4><div id="topExp" style="color: var(--danger);">â‚ª0</div></div>
        <div class="stat-card"><h4>×™×ª×¨×” ×¤× ×•×™×”</h4><div id="topBal">â‚ª0</div></div>
    </div>

    <div class="main-grid">
        <div class="card">
            <h3>ğŸ“¥ ×”×–× ×” ×•× ×™×ª×•×—</h3>
            
            <label>×”×“×‘×§ ×˜×§×¡×˜ ××”×‘× ×§/××©×¨××™:</label>
            <textarea id="importText" rows="3" placeholder="×”×“×‘×§ ×›××Ÿ ×©×•×¨×•×ª ×©×œ××•×ª..."></textarea>
            <button class="btn btn-import" onclick="autoImport()">× ×ª×— ×•×”×•×¡×£ ××•×˜×•××˜×™×ª âš¡</button>

            <hr style="border:0; border-top:1px solid #334155; margin:20px 0;">

            <label>×¡×•×’ ×”×•×¦××”:</label>
            <select id="mainCat" onchange="loadSub()">
                <option value="income">ğŸ’° ×”×›× ×¡×•×ª (××©×›×•×¨×ª/××—×¨)</option>
                <option value="fixed">ğŸ  ×§×‘×•×¢×•×ª (××©×›× ×ª×/××¨× ×•× ×”/×—×©××œ/××™×)</option>
                <option value="variable">ğŸ›’ ××©×ª× ×•×ª (×¡×•×¤×¨/×“×œ×§/×ª×§×©×•×¨×ª)</option>
                <option value="loans">ğŸ’³ ×”×œ×•×•××•×ª ×•×›×¨×˜×™×¡×™ ××©×¨××™</option>
                <option value="extra">âœˆï¸ ×‘×œ×˜"××™× (×©×™×¤×•×¥/× ×•×¤×©)</option>
            </select>

            <label>×¡×¢×™×£:</label>
            <select id="subCat"></select>

            <label>×¡×›×•×:</label>
            <input type="number" id="sum" placeholder="0.00">

            <button class="btn" onclick="addNew()">×”×•×¡×£ ×œ×××–×Ÿ âœ¨</button>
        </div>

        <div class="card">
            <h3>ğŸ”® ×ª×—×–×™×ª 3 ×—×•×“×©×™× ×§×“×™××”</h3>
            <div class="forecast-container" id="forecast">
                </div>

            <h3 style="margin-top: 30px;">ğŸ“‹ ×¤×™×¨×•×˜ ×ª× ×•×¢×•×ª</h3>
            <div id="log" style="max-height: 400px; overflow-y: auto;"></div>
            <button onclick="clearAll()" style="background:none; border:none; color:var(--danger); cursor:pointer; margin-top:20px; font-size:0.8rem;">ğŸ—‘ï¸ ××—×§ ×”×›×œ ×•××¤×¡ ×—×•×“×©</button>
        </div>
    </div>

    <footer class="footer">
        <p><strong>×‘×•×¢×– ×¡×¢×“×” - ×¤×ª×¨×•× ×•×ª ×™×¦×™×¨×ª×™×™×</strong></p>
        <p>Â© 2026 ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
    </footer>
</div>

<script>
    const menu = {
        income: ["××©×›×•×¨×ª ×‘×•×¢×–", "××©×›×•×¨×ª × ×•×¡×¤×ª", "×”×›× ×¡×” ××—×¨×ª"],
        fixed: ["××©×›× ×ª×", "××¨× ×•× ×”", "××™×", "×—×©××œ", "×•×¢×“ ×‘×™×ª", "×‘×™×˜×•×—×™×"],
        variable: ["×¡×•×¤×¨ ×•×§× ×™×•×ª", "×“×œ×§ ×•×ª×—×‘×•×¨×”", "××™× ×˜×¨× ×˜ ×•×˜×œ×•×•×™×–×™×”", "×˜×œ×¤×•× ×™×", "×¤××¨×"],
        loans: ["×”×œ×•×•××” ×‘× ×§××™×ª", "×”×œ×•×•××ª ×¨×›×‘", "××©×¨××™ ×›×¨×˜×™×¡ 1", "××©×¨××™ ×›×¨×˜×™×¡ 2"],
        extra: ["×©×™×¤×•×¥ ×•×ª×—×–×•×§×”", "× ×•×¤×© ×‘××¨×¥", "×—×•×¤×©×” ×‘×—×•\"×œ", "×‘×œ×˜\"× ×—×™×¨×•×"]
    };

    let items = JSON.parse(localStorage.getItem('bs_fin_v5') || '[]');

    function loadSub() {
        const m = document.getElementById('mainCat').value;
        const s = document.getElementById('subCat');
        s.innerHTML = menu[m].map(i => `<option value="${i}">${i}</option>`).join('');
    }

    function refresh() {
        const log = document.getElementById('log');
        const fore = document.getElementById('forecast');
        let inc = 0, exp = 0, fixedExp = 0, fixedInc = 0;
        
        log.innerHTML = '';
        items.forEach((item, idx) => {
            const isInc = item.type === 'income';
            if (isInc) { inc += item.val; if(item.main==='income') fixedInc += item.val; }
            else { exp += item.val; if(item.main==='fixed' || item.main==='loans') fixedExp += item.val; }

            log.innerHTML += `
                <div class="log-item">
                    <span>${item.sub} <small style="color:#64748b">(${item.date})</small></span>
                    <span style="color:${isInc ? 'var(--primary)' : 'var(--danger)'}">
                        ${isInc ? '+' : '-'}${item.val.toLocaleString()} â‚ª
                    </span>
                </div>
            `;
        });

        document.getElementById('topInc').innerText = `â‚ª${inc.toLocaleString()}`;
        document.getElementById('topExp').innerText = `â‚ª${exp.toLocaleString()}`;
        document.getElementById('topBal').innerText = `â‚ª${(inc - exp).toLocaleString()}`;

        // ×ª×—×–×™×ª
        fore.innerHTML = '';
        let running = inc - exp;
        for(let i=1; i<=3; i++) {
            if (i > 1) running += (fixedInc - fixedExp); 
            const isRed = running < 0;
            fore.innerHTML += `
                <div class="f-box" style="border-color:${isRed ? 'var(--danger)':'#334155'}">
                    <div style="color:var(--primary)">×—×•×“×© ${i}</div>
                    <div style="font-weight:bold; color:${isRed ? 'var(--danger)':'white'}">â‚ª${running.toLocaleString()}</div>
                </div>
            `;
        }
    }

    function addNew() {
        const val = parseFloat(document.getElementById('sum').value);
        const sub = document.getElementById('subCat').value;
        const main = document.getElementById('mainCat').value;
        if(!val) return;

        items.unshift({ val, sub, main, type: main === 'income' ? 'income' : 'exp', date: new Date().toLocaleDateString('he-IL') });
        save();
    }

    function autoImport() {
        const txt = document.getElementById('importText').value;
        const matches = txt.match(/(\d{1,3}(?:,\d{3})*(?:\.\d+)?)/g);
        if (matches) {
            matches.forEach(m => {
                const val = parseFloat(m.replace(/,/g, ''));
                if (val > 10) { // ×¡×™× ×•×Ÿ ××¡×¤×¨×™× ×§×˜× ×™× ××“×™
                    items.unshift({ val, sub: "×™×™×‘×•× ××•×˜×•××˜×™", main: 'variable', type: 'exp', date: new Date().toLocaleDateString('he-IL') });
                }
            });
            document.getElementById('importText').value = '';
            save();
            alert("×”× ×ª×•× ×™× × ×•×ª×—×• ×•×”×ª×•×•×¡×¤×•!");
        }
    }

    function save() { localStorage.setItem('bs_fin_v5', JSON.stringify(items)); refresh(); }
    function clearAll() { if(confirm("×œ××—×•×§ ×”×›×œ?")) { items = []; save(); } }

    loadSub();
    refresh();
</script>
</body>
</html>
